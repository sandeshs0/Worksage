<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Protection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-form { max-width: 500px; margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 5px; }
        .input-field { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 3px; }
        .btn { background: #007991; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; }
        .btn:hover { background: #005566; }
        .warning { background: #fee; border: 1px solid #fcc; padding: 10px; margin: 10px 0; border-radius: 3px; color: #c66; }
        .success { background: #efe; border: 1px solid #cfc; padding: 10px; margin: 10px 0; border-radius: 3px; color: #6c6; }
        .payload { background: #f8f8f8; padding: 5px; font-family: monospace; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Frontend XSS Protection Test Suite</h1>
    <p>This page tests our frontend XSS protection by attempting to inject various malicious payloads.</p>
    
    <div class="test-form">
        <h3>üß™ Test Input Sanitization</h3>
        <p>Try entering the following XSS payloads in the input field below:</p>
        
        <div class="payload">&lt;script&gt;alert('XSS')&lt;/script&gt;</div>
        <div class="payload">&lt;img src="x" onerror="alert('XSS')"&gt;</div>
        <div class="payload">javascript:alert('XSS')</div>
        <div class="payload">&lt;svg onload="alert('XSS')"&gt;&lt;/svg&gt;</div>
        <div class="payload">&lt;iframe src="javascript:alert('XSS')"&gt;&lt;/iframe&gt;</div>
        
        <input type="text" id="testInput" class="input-field" placeholder="Enter XSS payload here...">
        <button class="btn" onclick="testSanitization()">Test Sanitization</button>
        
        <div id="results"></div>
    </div>

    <div class="test-form">
        <h3>üìù Test Form Submission</h3>
        <form id="testForm" onsubmit="testFormSubmission(event)">
            <input type="text" name="username" class="input-field" placeholder="Username" required>
            <input type="email" name="email" class="input-field" placeholder="Email" required>
            <textarea name="message" class="input-field" placeholder="Message" rows="3"></textarea>
            <button type="submit" class="btn">Submit Form</button>
        </form>
        <div id="formResults"></div>
    </div>

    <div class="test-form">
        <h3>üìä Protection Statistics</h3>
        <div id="stats">
            <p>Tests Run: <span id="testsRun">0</span></p>
            <p>XSS Attempts Blocked: <span id="blockedAttempts">0</span></p>
            <p>Safe Inputs Allowed: <span id="safeInputs">0</span></p>
        </div>
    </div>

    <script type="module">
        import { sanitizeInput, validateXSS, escapeHTML } from './src/utils/xssProtection.js';
        
        let testsRun = 0;
        let blockedAttempts = 0;
        let safeInputs = 0;

        window.testSanitization = function() {
            const input = document.getElementById('testInput').value;
            const results = document.getElementById('results');
            
            testsRun++;
            
            if (!input.trim()) {
                results.innerHTML = '<div class="warning">Please enter some content to test</div>';
                return;
            }
            
            // Test XSS validation
            const validation = validateXSS(input);
            
            // Test sanitization
            const sanitized = sanitizeInput(input);
            const escaped = escapeHTML(input);
            
            let resultHTML = '<h4>Test Results:</h4>';
            
            if (!validation.isValid) {
                blockedAttempts++;
                resultHTML += `
                    <div class="warning">
                        <strong>‚ö†Ô∏è XSS Threats Detected:</strong>
                        <ul>
                            ${validation.threats.map(threat => `<li>${threat}</li>`).join('')}
                        </ul>
                    </div>
                `;
            } else {
                safeInputs++;
                resultHTML += '<div class="success">‚úÖ No XSS threats detected</div>';
            }
            
            resultHTML += `
                <p><strong>Original Input:</strong></p>
                <div class="payload">${escapeHTML(input)}</div>
                
                <p><strong>Sanitized Output:</strong></p>
                <div class="payload">${escapeHTML(sanitized)}</div>
                
                <p><strong>HTML Escaped:</strong></p>
                <div class="payload">${escapeHTML(escaped)}</div>
            `;
            
            results.innerHTML = resultHTML;
            updateStats();
        };
        
        window.testFormSubmission = function(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const formResults = document.getElementById('formResults');
            
            testsRun++;
            
            let hasThreats = false;
            let resultHTML = '<h4>Form Sanitization Results:</h4>';
            
            for (const [key, value] of formData.entries()) {
                const validation = validateXSS(value);
                const sanitized = sanitizeInput(value);
                
                if (!validation.isValid) {
                    hasThreats = true;
                    blockedAttempts++;
                    resultHTML += `
                        <div class="warning">
                            <strong>Field "${key}" - XSS Detected:</strong>
                            <ul>
                                ${validation.threats.map(threat => `<li>${threat}</li>`).join('')}
                            </ul>
                            <p>Sanitized: ${escapeHTML(sanitized)}</p>
                        </div>
                    `;
                } else {
                    safeInputs++;
                    resultHTML += `
                        <div class="success">
                            Field "${key}": ‚úÖ Safe (${escapeHTML(sanitized)})
                        </div>
                    `;
                }
            }
            
            if (!hasThreats) {
                resultHTML += '<div class="success">üéâ All form fields are secure!</div>';
            }
            
            formResults.innerHTML = resultHTML;
            updateStats();
        };
        
        function updateStats() {
            document.getElementById('testsRun').textContent = testsRun;
            document.getElementById('blockedAttempts').textContent = blockedAttempts;
            document.getElementById('safeInputs').textContent = safeInputs;
        }
        
        // Auto-populate with XSS test data for demonstration
        window.addEventListener('load', function() {
            const testPayloads = [
                '<script>alert("XSS")</script>',
                '<img src="x" onerror="alert(\'XSS\')">',
                'javascript:alert("XSS")',
                '<svg onload="alert(\'XSS\')"></svg>',
                '<iframe src="javascript:alert(\'XSS\')"></iframe>'
            ];
            
            console.log('üõ°Ô∏è XSS Protection Test Page Loaded');
            console.log('Available test payloads:', testPayloads);
            console.log('Try copying and pasting these into the input fields above');
        });
    </script>
</body>
</html>
